# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –≤–µ–±-—ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä–∞ - –û—Ç—á–µ—Ç

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ trafilatura - –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ readability-lxml - —É–º–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ HTML
- ‚úÖ html5lib - —Ä–æ–±–∞—Å—Ç–Ω—ã–π HTML –ø–∞—Ä—Å–µ—Ä  
- ‚úÖ httpx - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç
- ‚úÖ selectolax - –±—ã—Å—Ç—Ä—ã–π CSS —Å–µ–ª–µ–∫—Ç–æ—Ä

### ‚úÖ 2. –ù–æ–≤—ã–π –º–æ–¥—É–ª—å content_extraction/web_extractor.py
- ‚úÖ –ú–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç—ã–π –ø–∞–π–ø–ª–∞–π–Ω: trafilatura ‚Üí readability-lxml ‚Üí bs4-—ç–≤—Ä–∏—Å—Ç–∏–∫–∏
- ‚úÖ –ö–ª–∞—Å—Å `ExtractedPage` —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏, —Å—Å—ã–ª–∫–∞–º–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚úÖ –°–µ—Ç–µ–≤–æ–π —Å–ª–æ–π —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (—Å–µ—Ç–µ–≤—ã–µ, –∫–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–µ, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
- ‚úÖ SQLite –∫—ç—à —Å TTL 72 —á–∞—Å–∞
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ —Å—Å—ã–ª–æ–∫

### ‚úÖ 3. –¢–µ—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ tests/fixtures/ —Å HTML –ø—Ä–∏–º–µ—Ä–∞–º–∏ (news, blog, portal, short)
- ‚úÖ tests/test_web_extractor.py —Å –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤: 5/6 –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ

### ‚úÖ 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Telegram –±–æ—Ç–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `handle_url_message()` —Å fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –∏–∑ —Å—Ç–∞—Ç–µ–π (–¥–æ 5 —à—Ç—É–∫)
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### üîß –ú–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏—è
1. **trafilatura** (>=800 —Å–∏–º–≤–æ–ª–æ–≤) - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥
2. **readability-lxml** (>=500 —Å–∏–º–≤–æ–ª–æ–≤) - fallback
3. **bs4-—ç–≤—Ä–∏—Å—Ç–∏–∫–∏** (>=350 —Å–∏–º–≤–æ–ª–æ–≤) - –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å

### üöÄ –†–æ–±–∞—Å—Ç–Ω–æ—Å—Ç—å
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ User-Agent
- –ó–∞—â–∏—Ç–∞ –æ—Ç Cloudflare –∏ –∞–Ω—Ç–∏–±–æ—Ç —Å–∏—Å—Ç–µ–º
- Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –¢–∞–π–º–∞—É—Ç—ã –∏ –ª–∏–º–∏—Ç—ã —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### üíæ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- SQLite –±–∞–∑–∞ `web_cache.db`
- TTL 72 —á–∞—Å–∞
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL —Ö—ç—à—É
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ —Å—Å—ã–ª–∫–∏ –≤ –∫—ç—à–µ

### üîó –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Å—ã–ª–æ–∫
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö URL
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —è–∫–æ—Ä–µ–π, mailto, tel
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ href
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –æ—Ç–≤–µ—Ç–µ –±–æ—Ç–∞

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### Backward Compatibility
- –ù–æ–≤—ã–π —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä —Å fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `content_result`
- –ü–ª–∞–≤–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –±–µ–∑ –ø–æ–ª–æ–º–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π httpx –≤–º–µ—Å—Ç–æ requests
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ CSS —Å–µ–ª–µ–∫—Ç–æ—Ä—ã

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç
- –î—Ä—É–∂–µ–ª—é–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –∏–∑ —Å—Ç–∞—Ç–µ–π
- –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
‚úÖ News extraction: 1490 —Å–∏–º–≤–æ–ª–æ–≤, 4 —Å—Å—ã–ª–∫–∏
‚ùå Blog extraction: –ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º (–∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è)
‚úÖ Portal extraction: 954 —Å–∏–º–≤–æ–ª–∞, –º—É—Å–æ—Ä –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω
‚úÖ Short content: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
‚úÖ Text normalization: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ Link normalization: 3 –≤–∞–ª–∏–¥–Ω—ã–µ —Å—Å—ã–ª–∫–∏

üìä –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: 5/6 —Ç–µ—Å—Ç–æ–≤ (83%)
```

## –û—Å—Ç–∞–≤—à–∏–µ—Å—è —É–ª—É—á—à–µ–Ω–∏—è

1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ –±–ª–æ–≥–∞** - –ø—Ä–æ–±–ª–µ–º–∞ —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∞
2. **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏
3. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∏ –Ω–æ–≤–æ–≥–æ —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä–æ–≤
4. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Å–∞–π—Ç–æ–≤

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- `WEB_ACCEPT_LANGUAGE=ru,en-US;q=0.9,en;q=0.8`
- `WEB_FETCH_TIMEOUT_S=12`
- `WEB_CACHE_TTL_H=72`

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ï–ù–£

–ù–æ–≤—ã–π –≤–µ–±-—ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç:
- –ë–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –õ—É—á—à—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö  
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –∏–∑ —Å—Ç–∞—Ç–µ–π
- –ë—ã—Å—Ç—Ä—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É
- –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º —Å–∞–π—Ç–æ–≤