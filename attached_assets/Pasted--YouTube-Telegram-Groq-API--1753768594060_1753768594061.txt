# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ YouTube –≤–∏–¥–µ–æ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Telegram –±–æ—Ç —Å Groq API

## –ó–∞–¥–∞—á–∞
–î–æ–±–∞–≤–∏—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Telegram –±–æ—Ç (–∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Groq API) —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ YouTube –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ yt-dlp + open-source Whisper + Groq API.

## 1. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–æ–±–∞–≤—å –≤ requirements.txt:
```
yt-dlp>=2023.7.6
openai-whisper>=20231117
torch>=2.0.0
torchaudio>=2.0.0
pydub>=0.25.1
validators>=0.22.0
```

## 2. –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –§—É–Ω–∫—Ü–∏—è 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ YouTube URL
```python
import re
import validators

def extract_youtube_urls(text):
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç YouTube URL –∏–∑ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è"""
    youtube_patterns = [
        r'(?:https?://)?(?:www\.)?youtube\.com/watch\?v=([a-zA-Z0-9_-]+)',
        r'(?:https?://)?(?:www\.)?youtu\.be/([a-zA-Z0-9_-]+)',
        r'(?:https?://)?(?:www\.)?youtube\.com/embed/([a-zA-Z0-9_-]+)',
        r'(?:https?://)?(?:www\.)?youtube\.com/v/([a-zA-Z0-9_-]+)'
    ]
    
    youtube_urls = []
    for pattern in youtube_patterns:
        matches = re.finditer(pattern, text)
        for match in matches:
            video_id = match.group(1)
            full_url = f"https://www.youtube.com/watch?v={video_id}"
            youtube_urls.append({
                'url': full_url,
                'video_id': video_id,
                'original_url': match.group(0)
            })
    
    return youtube_urls

def validate_youtube_url(url):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å YouTube –≤–∏–¥–µ–æ"""
    try:
        import yt_dlp
        
        ydl_opts = {
            'quiet': True,
            'no_warnings': True,
        }
        
        with yt_dlp.YoutubeDL(ydl_opts) as ydl:
            info = ydl.extract_info(url, download=False)
            
            duration = info.get('duration', 0)
            if duration > 3600:  # 1 —á–∞—Å –º–∞–∫—Å–∏–º—É–º
                return {
                    'valid': False,
                    'error': '–í–∏–¥–µ–æ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–±–æ–ª–µ–µ 1 —á–∞—Å–∞)'
                }
            
            if info.get('is_live'):
                return {
                    'valid': False,
                    'error': '–ü—Ä—è–º—ã–µ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è'
                }
            
            return {
                'valid': True,
                'title': info.get('title', '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'),
                'duration': duration,
                'uploader': info.get('uploader', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'),
                'view_count': info.get('view_count', 0)
            }
            
    except Exception as e:
        return {
            'valid': False,
            'error': f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –≤–∏–¥–µ–æ: {str(e)}'
        }
```

### –§—É–Ω–∫—Ü–∏—è 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ –∏–∑ YouTube
```python
import yt_dlp
import os
import tempfile

def extract_audio_from_youtube(url, max_duration=3600):
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫—É –∏–∑ YouTube –≤–∏–¥–µ–æ"""
    try:
        temp_dir = tempfile.mkdtemp()
        
        ydl_opts = {
            'format': 'bestaudio/best',
            'outtmpl': os.path.join(temp_dir, '%(title)s.%(ext)s'),
            'extractaudio': True,
            'audioformat': 'wav',
            'audioquality': '0',
            'quiet': True,
            'no_warnings': True,
            'postprocessors': [{
                'key': 'FFmpegExtractAudio',
                'preferredcodec': 'wav',
                'preferredquality': '0',
            }],
        }
        
        with yt_dlp.YoutubeDL(ydl_opts) as ydl:
            info = ydl.extract_info(url, download=False)
            
            duration = info.get('duration', 0)
            if duration > max_duration:
                raise Exception(f"–í–∏–¥–µ–æ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ: {duration//60} –º–∏–Ω—É—Ç")
            
            ydl.download([url])
            
            for file in os.listdir(temp_dir):
                if file.endswith('.wav'):
                    audio_path = os.path.join(temp_dir, file)
                    
                    return {
                        'success': True,
                        'audio_path': audio_path,
                        'title': info.get('title', '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'),
                        'duration': duration,
                        'uploader': info.get('uploader', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'),
                        'temp_dir': temp_dir
                    }
        
        raise Exception("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∞—É–¥–∏–æ —Ñ–∞–π–ª")
        
    except Exception as e:
        return {
            'success': False,
            'error': f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∞—É–¥–∏–æ: {str(e)}'
        }
```

### –§—É–Ω–∫—Ü–∏—è 3: –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è —á–µ—Ä–µ–∑ open-source Whisper
```python
import whisper
import torch

# –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –º–æ–¥–µ–ª–∏ Whisper
whisper_model = None

def load_whisper_model():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç Whisper –º–æ–¥–µ–ª—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏"""
    global whisper_model
    if whisper_model is None:
        try:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º base –º–æ–¥–µ–ª—å –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞
            whisper_model = whisper.load_model("base")
            print("Whisper –º–æ–¥–µ–ª—å 'base' –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Whisper: {e}")
            # Fallback –Ω–∞ —Å–∞–º—É—é –º–∞–ª–µ–Ω—å–∫—É—é –º–æ–¥–µ–ª—å
            whisper_model = whisper.load_model("tiny")
            
    return whisper_model

def transcribe_audio_whisper(audio_path, language='auto'):
    """–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ open-source Whisper"""
    try:
        model = load_whisper_model()
        if model is None:
            return {
                'success': False,
                'error': '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å Whisper'
            }
        
        options = {
            'language': None if language == 'auto' else language,
            'task': 'transcribe',
            'fp16': False  # –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        }
        
        print(f"–ù–∞—á–∏–Ω–∞—é —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—é —Ñ–∞–π–ª–∞: {audio_path}")
        result = model.transcribe(audio_path, **options)
        
        return {
            'success': True,
            'text': result['text'],
            'language': result.get('language', 'unknown')
        }
        
    except Exception as e:
        return {
            'success': False,
            'error': f'–û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏: {str(e)}'
        }

def split_audio_for_whisper(audio_path, max_duration_minutes=20):
    """–†–∞–∑–±–∏–≤–∞–µ—Ç –¥–ª–∏–Ω–Ω–æ–µ –∞—É–¥–∏–æ –Ω–∞ —á–∞—Å—Ç–∏"""
    try:
        from pydub import AudioSegment
        
        audio = AudioSegment.from_wav(audio_path)
        duration_ms = len(audio)
        
        # –ï—Å–ª–∏ –∞—É–¥–∏–æ –∫–æ—Ä–æ—Ç–∫–æ–µ, –Ω–µ —Ä–∞–∑–±–∏–≤–∞–µ–º
        if duration_ms < max_duration_minutes * 60 * 1000:
            return [audio_path]
        
        # –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —á–∞—Å—Ç–∏
        chunk_length_ms = max_duration_minutes * 60 * 1000
        chunks = []
        
        for i in range(0, duration_ms, chunk_length_ms):
            chunk = audio[i:i + chunk_length_ms]
            chunk_path = audio_path.replace('.wav', f'_part_{i//chunk_length_ms + 1}.wav')
            chunk.export(chunk_path, format="wav")
            chunks.append(chunk_path)
        
        return chunks
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ —Ä–∞–∑–±–∏–≤–∫–∏ –∞—É–¥–∏–æ: {e}")
        return [audio_path]

def transcribe_long_audio(audio_path):
    """–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –¥–ª–∏–Ω–Ω–æ–µ –∞—É–¥–∏–æ –ø–æ —á–∞—Å—Ç—è–º"""
    chunks = split_audio_for_whisper(audio_path)
    full_transcript = ""
    
    for i, chunk_path in enumerate(chunks):
        print(f"–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é —á–∞—Å—Ç—å {i+1}/{len(chunks)}")
        
        result = transcribe_audio_whisper(chunk_path)
        if result['success']:
            if i > 0:
                full_transcript += f"\n\n--- –ß–∞—Å—Ç—å {i+1} ---\n"
            full_transcript += result['text']
        else:
            print(f"–û—à–∏–±–∫–∞ –≤ —á–∞—Å—Ç–∏ {i+1}: {result['error']}")
        
        # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —á–∞—Å—Ç–∏
        if chunk_path != audio_path:
            try:
                os.remove(chunk_path)
            except:
                pass
    
    return {
        'success': True if full_transcript else False,
        'text': full_transcript,
        'parts_count': len(chunks)
    }
```

### –§—É–Ω–∫—Ü–∏—è 4: –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Groq (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É)
```python
from groq import Groq
import os

def summarize_youtube_transcript(transcript, video_title="", video_duration=0):
    """–°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑—é–º–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞ YouTube –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ Groq API"""
    try:
        client = Groq(api_key=os.getenv("GROQ_API_KEY"))
        
        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞
        max_chars = 10000
        if len(transcript) > max_chars:
            transcript = transcript[:max_chars] + "...\n[–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –æ–±—Ä–µ–∑–∞–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏]"
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–ª–∏–Ω—É —Ä–µ–∑—é–º–µ
        if video_duration < 600:  # –ú–µ–Ω–µ–µ 10 –º–∏–Ω—É—Ç
            summary_length = "150-250 —Å–ª–æ–≤"
            max_tokens = 300
        elif video_duration < 1800:  # –ú–µ–Ω–µ–µ 30 –º–∏–Ω—É—Ç
            summary_length = "250-400 —Å–ª–æ–≤"
            max_tokens = 450
        else:  # –ë–æ–ª–µ–µ 30 –º–∏–Ω—É—Ç
            summary_length = "400-600 —Å–ª–æ–≤"
            max_tokens = 600
        
        duration_str = f"{video_duration//60} –º–∏–Ω—É—Ç {video_duration%60} —Å–µ–∫—É–Ω–¥"
        
        prompt = f"""–°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ–∑—é–º–µ YouTube –≤–∏–¥–µ–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –í–ò–î–ï–û:
–ù–∞–∑–≤–∞–Ω–∏–µ: {video_title}
–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {duration_str}

–¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –†–ï–ó–Æ–ú–ï:
- –û–±—ä–µ–º: {summary_length}
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–º–∞, –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã, –≥–ª–∞–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã
- –ò—Å–ø–æ–ª—å–∑—É–π –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –∏–¥–µ–π
- –°–æ—Ö—Ä–∞–Ω–∏ –≤–∞–∂–Ω—ã–µ —Ñ–∞–∫—Ç—ã, —Ü–∏—Ñ—Ä—ã, –∏–º–µ–Ω–∞
- –ü–∏—à–∏ –ø–æ–Ω—è—Ç–Ω—ã–º –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —è–∑—ã–∫–æ–º

–¢–†–ê–ù–°–ö–†–ò–ü–¢ –í–ò–î–ï–û:
{transcript}

–°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–û–ï –†–ï–ó–Æ–ú–ï:"""

        completion = client.chat.completions.create(
            messages=[
                {
                    "role": "system", 
                    "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–µ–∑—é–º–µ –≤–∏–¥–µ–æ–∫–æ–Ω—Ç–µ–Ω—Ç–∞. –°–æ–∑–¥–∞–≤–∞–π —á–µ—Ç–∫–∏–µ, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –∏ –ø–æ–ª–µ–∑–Ω—ã–µ —Å–∞–º–º–∞—Ä–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ."
                },
                {
                    "role": "user", 
                    "content": prompt
                }
            ],
            model="llama3-8b-8192",
            max_tokens=max_tokens,
            temperature=0.3
        )
        
        summary = completion.choices[0].message.content.strip()
        
        return {
            'success': True,
            'summary': summary
        }
        
    except Exception as e:
        return {
            'success': False,
            'error': f'–û—à–∏–±–∫–∞ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ Groq: {str(e)}'
        }

def create_fallback_summary(transcript, video_title=""):
    """–ü—Ä–æ—Å—Ç–æ–µ —Ä–µ–∑—é–º–µ –±–µ–∑ AI –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç"""
    try:
        sentences = transcript.split('.')
        sentences = [s.strip() for s in sentences if len(s.strip()) > 30]
        
        # –ë–µ—Ä–µ–º –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        summary_sentences = []
        if len(sentences) > 0:
            summary_sentences.append(sentences[0])  # –ù–∞—á–∞–ª–æ
        if len(sentences) > 4:
            summary_sentences.append(sentences[len(sentences)//3])  # –¢—Ä–µ—Ç—å
            summary_sentences.append(sentences[2*len(sentences)//3])  # –î–≤–µ —Ç—Ä–µ—Ç–∏
        if len(sentences) > 1:
            summary_sentences.append(sentences[-1])  # –ö–æ–Ω–µ—Ü
        
        summary = '. '.join(summary_sentences)
        
        if len(summary) > 1000:
            summary = summary[:1000] + "..."
        
        summary += "\n\n‚ö†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ (AI —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)"
        
        return {
            'success': True,
            'summary': summary
        }
        
    except Exception as e:
        return {
            'success': False,
            'error': f'–û—à–∏–±–∫–∞ fallback —Ä–µ–∑—é–º–µ: {e}'
        }
```

## 3. –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –±–æ—Ç–æ–º

```python
import asyncio
import shutil

async def handle_youtube_video(update, context):
    """–ì–ª–∞–≤–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ YouTube —Å—Å—ã–ª–æ–∫"""
    message_text = update.message.text
    chat_id = update.message.chat_id
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º YouTube URL
    youtube_urls = extract_youtube_urls(message_text)
    
    if not youtube_urls:
        return  # –ï—Å–ª–∏ YouTube URL –Ω–µ—Ç, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
    
    # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ
    if len(youtube_urls) > 1:
        await context.bot.send_message(
            chat_id=chat_id,
            text="‚ö†Ô∏è –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–µ –≤–∏–¥–µ–æ –∏–∑ —Å–ø–∏—Å–∫–∞."
        )
        youtube_urls = youtube_urls[:1]
    
    for url_info in youtube_urls:
        url = url_info['url']
        
        # –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        processing_msg = await context.bot.send_message(
            chat_id=chat_id,
            text="üé• –ù–∞—á–∏–Ω–∞—é –æ–±—Ä–∞–±–æ—Ç–∫—É YouTube –≤–∏–¥–µ–æ...\n‚è≥ –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–π–º–µ—Ç 3-8 –º–∏–Ω—É—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏."
        )
        
        try:
            # –≠—Ç–∞–ø 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–µ–æ
            await context.bot.edit_message_text(
                chat_id=chat_id,
                message_id=processing_msg.message_id,
                text="üîç –ü—Ä–æ–≤–µ—Ä—è—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∏–¥–µ–æ..."
            )
            
            validation = validate_youtube_url(url)
            if not validation['valid']:
                await context.bot.edit_message_text(
                    chat_id=chat_id,
                    message_id=processing_msg.message_id,
                    text=f"‚ùå {validation['error']}"
                )
                continue
            
            video_title = validation['title']
            video_duration = validation['duration']
            video_uploader = validation['uploader']
            
            # –≠—Ç–∞–ø 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ
            await context.bot.edit_message_text(
                chat_id=chat_id,
                message_id=processing_msg.message_id,
                text=f"üéµ –ò–∑–≤–ª–µ–∫–∞—é –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫—É...\nüìπ {video_title[:60]}..."
            )
            
            audio_result = extract_audio_from_youtube(url)
            if not audio_result['success']:
                await context.bot.edit_message_text(
                    chat_id=chat_id,
                    message_id=processing_msg.message_id,
                    text=f"‚ùå –û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞—É–¥–∏–æ: {audio_result['error']}"
                )
                continue
            
            # –≠—Ç–∞–ø 3: –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è
            await context.bot.edit_message_text(
                chat_id=chat_id,
                message_id=processing_msg.message_id,
                text="üé§ –ü—Ä–µ–æ–±—Ä–∞–∑—É—é —Ä–µ—á—å –≤ —Ç–µ–∫—Å—Ç (Whisper AI)...\n–≠—Ç–æ —Å–∞–º—ã–π –¥–æ–ª–≥–∏–π —ç—Ç–∞–ø: 3-6 –º–∏–Ω—É—Ç."
            )
            
            # –í—ã–±–∏—Ä–∞–µ–º –º–µ—Ç–æ–¥ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            if video_duration > 1200:  # –ë–æ–ª–µ–µ 20 –º–∏–Ω—É—Ç
                transcript_result = transcribe_long_audio(audio_result['audio_path'])
            else:
                transcript_result = transcribe_audio_whisper(audio_result['audio_path'])
            
            if not transcript_result['success']:
                await context.bot.edit_message_text(
                    chat_id=chat_id,
                    message_id=processing_msg.message_id,
                    text=f"‚ùå –û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏: {transcript_result['error']}"
                )
                continue
            
            # –≠—Ç–∞–ø 4: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑—é–º–µ
            await context.bot.edit_message_text(
                chat_id=chat_id,
                message_id=processing_msg.message_id,
                text="üìù –°–æ–∑–¥–∞—é —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ–∑—é–º–µ (Groq AI)..."
            )
            
            summary_result = summarize_youtube_transcript(
                transcript_result['text'],
                video_title,
                video_duration
            )
            
            if not summary_result['success']:
                # Fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–µ —Ä–µ–∑—é–º–µ
                summary_result = create_fallback_summary(
                    transcript_result['text'],
                    video_title
                )
            
            if not summary_result['success']:
                summary_text = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑—é–º–µ"
            else:
                summary_text = summary_result['summary']
            
            # –§–æ—Ä–º–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
            duration_str = f"{video_duration//60}:{video_duration%60:02d}"
            transcript_length = len(transcript_result['text'])
            
            response = f"""üé• **–†–µ–∑—é–º–µ YouTube –≤–∏–¥–µ–æ**

üì∫ **–ù–∞–∑–≤–∞–Ω–∏–µ:** {video_title}
üë§ **–ê–≤—Ç–æ—Ä:** {video_uploader}
‚è±Ô∏è **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** {duration_str}
üîó **–°—Å—ã–ª–∫–∞:** {url}

üìã **–†–µ–∑—é–º–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è:**
{summary_text}

üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
‚Ä¢ –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç: {transcript_length:,} —Å–∏–º–≤–æ–ª–æ–≤
‚Ä¢ –ú–µ—Ç–æ–¥: Whisper + Groq (Llama3)
‚Ä¢ –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: ~{max(3, video_duration//60 + 2)} –º–∏–Ω—É—Ç"""

            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            await context.bot.edit_message_text(
                chat_id=chat_id,
                message_id=processing_msg.message_id,
                text=response,
                parse_mode='Markdown',
                disable_web_page_preview=True
            )
            
        except Exception as e:
            await context.bot.edit_message_text(
                chat_id=chat_id,
                message_id=processing_msg.message_id,
                text=f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {str(e)}"
            )
        
        finally:
            # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
            try:
                if 'audio_result' in locals() and audio_result.get('success'):
                    temp_dir = audio_result.get('temp_dir')
                    if temp_dir and os.path.exists(temp_dir):
                        shutil.rmtree(temp_dir)
                        print(f"–û—á–∏—â–µ–Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: {temp_dir}")
            except Exception as cleanup_error:
                print(f"–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏: {cleanup_error}")
```

## 4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –≤ –±–æ—Ç–µ

```python
# –í –≥–ª–∞–≤–Ω–æ–º —Ñ–∞–π–ª–µ –±–æ—Ç–∞ –¥–æ–±–∞–≤—å —ç—Ç–æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º
from telegram.ext import MessageHandler, filters

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ YouTube —Å—Å—ã–ª–æ–∫ (–¥–æ–±–∞–≤–∏—Ç—å —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º)
application.add_handler(MessageHandler(
    filters.TEXT & (
        filters.Regex(r'youtube\.com/watch') |
        filters.Regex(r'youtu\.be/') |
        filters.Regex(r'youtube\.com/embed/') |
        filters.Regex(r'youtube\.com/v/')
    ),
    handle_youtube_video
))
```

## 5. –ö–æ–º–∞–Ω–¥–∞ —Å–ø—Ä–∞–≤–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```python
async def youtube_help_command(update, context):
    """–°–ø—Ä–∞–≤–∫–∞ –ø–æ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ YouTube"""
    help_text = """üé• **–°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è YouTube –≤–∏–¥–µ–æ**

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ, –∏ –±–æ—Ç —Å–æ–∑–¥–∞—Å—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä–µ–∑—é–º–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
‚Ä¢ youtube.com/watch?v=...
‚Ä¢ youtu.be/...
‚Ä¢ youtube.com/embed/...

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 1 —á–∞—Å
‚Ä¢ –ó–∞–∫—Ä—ã—Ç—ã–µ/–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –≤–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
‚Ä¢ –ü—Ä—è–º—ã–µ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è

**–ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
1. üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (10 —Å–µ–∫)
2. üéµ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ (30-60 —Å–µ–∫)
3. üé§ –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è —Ä–µ—á–∏ (3-6 –º–∏–Ω)
4. üìù –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑—é–º–µ (30 —Å–µ–∫)

**–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:** 3-8 –º–∏–Ω—É—Ç

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
‚Ä¢ yt-dlp –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞—É–¥–∏–æ
‚Ä¢ Whisper AI –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
‚Ä¢ Groq (Llama3) –¥–ª—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏"""

    await update.message.reply_text(help_text, parse_mode='Markdown')

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã —Å–ø—Ä–∞–≤–∫–∏
application.add_handler(CommandHandler("youtube", youtube_help_command))
```

## 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –∑–∞–ø—É—Å–∫—É

### –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ .env –µ—Å—Ç—å:
```
GROQ_API_KEY=your_existing_groq_key
```

### –ü—Ä–æ–≤–µ—Ä—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- FFmpeg —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–æ–±—ã—á–Ω–æ –µ—Å—Ç—å –≤ Replit)
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –¥–ª—è Whisper
- Stable –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ

## 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç—ã:
1. **–ö–æ—Ä–æ—Ç–∫–æ–µ –≤–∏–¥–µ–æ (2-5 –º–∏–Ω)** - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
2. **–°—Ä–µ–¥–Ω–µ–µ –≤–∏–¥–µ–æ (15-20 –º–∏–Ω)** - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–±–∏–≤–∫–∏ –Ω–∞ —á–∞—Å—Ç–∏
3. **–î–ª–∏–Ω–Ω–æ–µ –≤–∏–¥–µ–æ (45-60 –º–∏–Ω)** - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤
4. **–†–∞–∑–Ω—ã–µ —è–∑—ã–∫–∏** - —Ä—É—Å—Å–∫–∏–π, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
5. **–†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞** - –ª–µ–∫—Ü–∏–∏, –∏–Ω—Ç–µ—Ä–≤—å—é, –Ω–æ–≤–æ—Å—Ç–∏

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 3-8 –º–∏–Ω—É—Ç
- –ö–∞—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏: 85-95% —Ç–æ—á–Ω–æ—Å—Ç—å
- –ö–∞—á–µ—Å—Ç–≤–æ —Ä–µ–∑—é–º–µ: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ
- –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: –±–µ–∑ –ø–∞–¥–µ–Ω–∏–π –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** –≠—Ç–æ—Ç –∫–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Ç–≤–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –±–æ—Ç —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Groq API.